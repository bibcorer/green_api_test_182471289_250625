<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ GREEN-API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
      width: 100%;
      max-width: 1000px;
    }
    .form-section {
      flex: 1;
      max-width: 400px;
    }
    .form-section input,
    .form-section button,
    .form-section textarea,
    .form-section label {
      width: 100%;
      margin: 10px 0;
    }
    .input-group {
      position: relative;
    }
    .toggle-visibility {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      cursor: pointer;
    }
    textarea {
      height: 500px;
      resize: none;
    }
    .response-section {
      flex: 1;
    }
    .response-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .response-toggle {
      cursor: pointer;
      font-size: 1.5rem;
    }
    .response-section textarea {
      width: 100%;
      height: 100%;
      resize: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-section">
      <h1>GREEN-API Demo</h1>

      <label for="idInstance">ID Instance</label>
      <div class="input-group">
        <input type="password" id="idInstance">
        <span class="toggle-visibility" onclick="toggleVisibility('idInstance', this)">üëÅÔ∏è</span>
      </div>

      <label for="apiTokenInstance">API Token</label>
      <div class="input-group">
        <input type="password" id="apiTokenInstance">
        <span class="toggle-visibility" onclick="toggleVisibility('apiTokenInstance', this)">üëÅÔ∏è</span>
      </div>

      <button onclick="callAPI('getSettings')">getSettings</button>
      <button onclick="callAPI('getStateInstance')">getStateInstance</button>

      <hr>
      <label for="phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+7...)</label>
      <div class="input-group">
        <input type="password" id="phone">
        <span class="toggle-visibility" onclick="toggleVisibility('phone', this)">üëÅÔ∏è</span>
      </div>

      <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
      <input type="text" id="message">

      <button onclick="sendMessage()">sendMessage</button>

      <label for="fileUrl">URL —Ñ–∞–π–ª–∞</label>
      <div class="input-group">
        <input type="password" id="fileUrl">
        <span class="toggle-visibility" onclick="toggleVisibility('fileUrl', this)">üëÅÔ∏è</span>
      </div>

      <button onclick="sendFileByUrl()">sendFileByUrl</button>
    </div>

    <div class="response-section">
      <div class="response-header">
        <h3>–û—Ç–≤–µ—Ç API:</h3>
        <span class="response-toggle" onclick="toggleResponseVisibility(this)">üëÅÔ∏è</span>
      </div>
      <textarea id="response" readonly></textarea>
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
    let lastFullResponse = null;
    let isResponseHidden = true;

    function toggleVisibility(inputId, iconElement) {
      const input = document.getElementById(inputId);
      if (input.type === "password") {
        input.type = "text";
        iconElement.textContent = "‚úîÔ∏è";
      } else {
        input.type = "password";
        iconElement.textContent = "üëÅÔ∏è";
      }
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –∫–æ–ø–∏—é –æ–±—ä–µ–∫—Ç–∞, –≥–¥–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.
     * @param {object} data - –ò—Å—Ö–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö.
     * @returns {object} - –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Å–æ —Å–∫—Ä—ã—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
     */
    function createHiddenResponse(data) {
      if (data === null || typeof data !== 'object') {
        return data; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã –∫–∞–∫ –µ—Å—Ç—å
      }
      
      const hiddenData = Array.isArray(data) ? [] : {};
      for (const key in data) {
        if (Object.prototype.hasOwnProperty.call(data, key)) {
          hiddenData[key] = '[INFO HIDDEN]';
        }
      }
      return hiddenData;
    }

    /**
     * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Ç–≤–µ—Ç API –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
     * @param {object} data - –û—Ç–≤–µ—Ç –æ—Ç API.
     */
    function displayResponse(data) {
      lastFullResponse = data; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç
      isResponseHidden = true; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "—Å–∫—Ä—ã—Ç–æ"
      
      const hiddenData = createHiddenResponse(data);
      document.getElementById('response').value = JSON.stringify(hiddenData, null, 2);
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–ø–æ–∫–∞–∑–∞—Ç—å"
      const toggleIcon = document.querySelector('.response-toggle');
      if (toggleIcon) {
        toggleIcon.textContent = 'üëÅÔ∏è';
      }
    }

    /**
     * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ API.
     * @param {HTMLElement} iconElement - –≠–ª–µ–º–µ–Ω—Ç –∏–∫–æ–Ω–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∂–∞–ª–∏.
     */
    function toggleResponseVisibility(iconElement) {
      if (!lastFullResponse) return; // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –µ—â–µ –Ω–µ –±—ã–ª–æ

      isResponseHidden = !isResponseHidden;
      const responseTextarea = document.getElementById('response');

      if (isResponseHidden) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä—ã—Ç—É—é –≤–µ—Ä—Å–∏—é
        responseTextarea.value = JSON.stringify(createHiddenResponse(lastFullResponse), null, 2);
        iconElement.textContent = 'üëÅÔ∏è';
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é
        responseTextarea.value = JSON.stringify(lastFullResponse, null, 2);
        iconElement.textContent = 'üôà';
      }
    }

    async function callAPI(method) {
      const id = document.getElementById('idInstance').value;
      const token = document.getElementById('apiTokenInstance').value;
      const urls = {
        getSettings: `https://api.green-api.com/waInstance${id}/getSettings/${token}`,
        getStateInstance: `https://api.green-api.com/waInstance${id}/getStateInstance/${token}`
      };
      try {
        const res = await fetch(urls[method]);
        const data = await res.json();
        displayResponse(data);
      } catch (error) {
        displayResponse({ error: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞", details: error.message });
      }
    }

    async function sendMessage() {
      const id = document.getElementById('idInstance').value;
      const token = document.getElementById('apiTokenInstance').value;
      const phone = document.getElementById('phone').value;
      const message = document.getElementById('message').value;

      try {
        const res = await fetch(`https://api.green-api.com/waInstance${id}/sendMessage/${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chatId: phone.replace('+', '') + "@c.us", message })
        });
        const data = await res.json();
        displayResponse(data);
      } catch (error) {
        displayResponse({ error: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞", details: error.message });
      }
    }

    async function sendFileByUrl() {
      const id = document.getElementById('idInstance').value;
      const token = document.getElementById('apiTokenInstance').value;
      const phone = document.getElementById('phone').value;
      const fileUrl = document.getElementById('fileUrl').value;
      
      try {
        const res = await fetch(`https://api.green-api.com/waInstance${id}/sendFileByUrl/${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chatId: phone.replace('+', '') + "@c.us", urlFile: fileUrl, fileName: "file" })
        });
        const data = await res.json();
        displayResponse(data);
      } catch (error) {
        displayResponse({ error: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞", details: error.message });
      }
    }
  </script>
</body>
</html>